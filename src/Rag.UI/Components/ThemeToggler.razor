@rendermode InteractiveServer
@inject IJSRuntime JSRuntime

<div class="inline-flex items-center select-none">
    <button type="button"
            role="button"
            aria-pressed="@isDarkMode"
            aria-label="Toggle dark mode"
            @onclick="ToggleAsync"
            class="relative h-6 w-11 shrink-0 cursor-pointer rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-800 flex px-[2px] @(isDarkMode ? "justify-end bg-blue-600" : "justify-start bg-gray-200 dark:bg-gray-700")">
        <span class="h-5 w-5 mr-[2px] mt-[2px] rounded-full bg-white border border-gray-300 dark:border-gray-600 shadow-sm transition-colors"></span>
    </button>
    <span class="ms-3 text-sm font-medium text-white dark:text-gray-300 mr-[2px] mt-[2px]">@(isDarkMode ? "Dark Mode" : "Light Mode")</span>
</div>

@code {
    private bool isDarkMode;
    private bool _initialized;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_initialized)
        {
            try
            {
                isDarkMode = await JSRuntime.InvokeAsync<bool>("themeToggler.isDark");
                _initialized = true;
                StateHasChanged();
            }
            catch { /* ignore */ }
        }
    }

    private async Task ToggleAsync()
    {
        try
        {
            var finalState = await JSRuntime.InvokeAsync<bool>("themeToggler.toggle");
            isDarkMode = finalState;
        }
        catch { /* ignore */ }
        StateHasChanged();
    }
}